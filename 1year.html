<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>JOB INFO - 統合ポータル（元デザイン寄せ）</title>
  <meta name="description" content="時間割・課題・行事を管理する統合ポータル（デモ）">
  <style>
    /* === 全体（元テンプレ風） === */
    :root{
      --primary: #2b6cb0; /* メイン色 */
      --accent: #0a6fb3;
      --muted: #6b7280;
      --bg: #f2f6fb;
      --container-bg: #ffffff;
      --link:#0a6fb3;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:"Hiragino Kaku Gothic ProN","Yu Gothic","Meiryo",sans-serif;background:var(--bg);color:#111}
    a{color:var(--link);text-decoration:none}
    #container{width:100%;max-width:1000px;margin:20px auto;background:var(--container-bg);box-shadow:0 2px 8px rgba(16,24,40,.06);border-radius:4px;overflow:hidden}
    header{padding:18px 20px;border-bottom:1px solid #e6edf3;display:flex;align-items:center;gap:16px}
    #logo img{height:56px;display:block}
    header h1{font-size:1.1rem;margin:0}
    header p.lead{margin:6px 0 0;color:var(--muted);font-size:0.95rem}

    /* === メインメニュー（元サイト風） === */
    nav#menubar{background:#fff;border-top:1px solid #f0f4f8;border-bottom:1px solid #f0f4f8}
    nav#menubar ul{list-style:none;margin:0;padding:0;display:flex;flex-wrap:wrap}
    nav#menubar ul > li{position:relative}
    nav#menubar > ul > li{padding:14px 18px;border-right:1px solid #f3f6f9}
    nav#menubar a{display:block;color:#222;font-weight:600}
    nav#menubar span{display:block;font-weight:400;font-size:0.85rem;color:var(--muted)}
    nav#menubar ul li ul{position:absolute;left:0;top:100%;background:#fff;min-width:160px;box-shadow:0 6px 18px rgba(12,20,30,.06);display:none;padding:8px 0;border-radius:4px}
    nav#menubar ul li:hover > ul{display:block}
    nav#menubar ul li ul li{padding:6px 12px;border-right:0;border-bottom:0}
    nav#menubar ul li ul li a{font-weight:500;color:#333}
    /* responsive menu button */
    #menubar_hdr{display:none}
    @media (max-width:800px){
      nav#menubar ul{flex-direction:column}
      nav#menubar > ul > li{border-right:0;border-bottom:1px solid #f3f6f9;padding:12px}
      nav#menubar ul li ul{position:static;box-shadow:none;padding-left:12px;display:none}
      nav#menubar ul li.open > ul{display:block}
      #menubar_hdr{display:block;padding:12px;border-top:1px solid #eef4fb;cursor:pointer;text-align:right}
    }

    /* === コンテンツエリア === */
    main{padding:18px 20px}
    .wrap-grid{display:grid;grid-template-columns:1fr 300px;gap:18px}
    @media (max-width:900px){.wrap-grid{grid-template-columns:1fr}}
    .card{background:transparent;padding:0}
    .panel{background:#fff;padding:14px;border-radius:6px;border:1px solid #eef4fb;box-shadow:0 1px 2px rgba(12,20,30,.02)}
    h2{margin:0 0 8px;font-size:1.05rem}
    .small{font-size:0.85rem;color:var(--muted)}
    .meta{color:var(--muted);font-size:0.85rem}

    /* テーブル */
    .tablewrap{overflow:auto;border-radius:6px}
    table{width:100%;border-collapse:collapse;font-size:0.95rem}
    th,td{padding:10px;border-bottom:1px solid #f3f6f9;text-align:left}
    th{background:#fafcff;font-weight:700;color:#233746}
    .Table-Head-Row-Cell{font-weight:700}

    /* 冬休み課題カード */
    .list-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-top:8px}
    .task-card{background:#fff;border-radius:6px;padding:12px;border:1px solid #eef4f8}
    .task-card h4{margin:0 0 8px}
    .task-card dl{margin:0}
    .task-card dt{font-weight:700}
    .task-card dd{margin:4px 0 8px}

    /* iframe */
    .iframewrap{position:relative;padding-bottom:56.25%;height:0;overflow:hidden;margin-top:8px}
    .iframewrap iframe{position:absolute;top:0;left:0;width:100%;height:100%;border:0}

    /* aside styles */
    aside .panel{margin-bottom:12px}
    footer{background:#fff;padding:14px 20px;border-top:1px solid #eef4f8;font-size:0.85rem;color:var(--muted);display:flex;justify-content:space-between;align-items:center}

    /* buttons */
    .btn{display:inline-block;padding:8px 12px;border-radius:6px;background:#f7fbff;border:1px solid #e6f0fa;color:var(--primary);cursor:pointer}
    .btn.primary{background:var(--primary);color:#fff;border-color:transparent}

    /* notice */
    .notice{background:#fffbe6;padding:10px;border:1px solid #fff3bf;border-radius:6px;color:#664d03}

    /* small utilities */
    .spaced{display:flex;justify-content:space-between;align-items:center}
    .searchin{padding:8px;border-radius:6px;border:1px solid #eef4f8;width:100%}

  </style>
</head>
<body>
  <div id="container">
    <!-- header -->
    <header>
      <div id="logo">
        <!-- 元サイトのロゴ画像パスを使っています。必要なら置き換えてください -->
        <a href="index.html"><img src="images/logo.png" alt="JOB INFO"></a>
      </div>
      <div style="flex:1">
        <h1>JOB INFO — 統合ポータル（デモ）</h1>
        <p class="lead">時間割・課題・行事をまとめて確認できます。管理者はログインして編集できます。</p>
      </div>
    </header>

    <!-- 元サイト風メインメニュー -->
    <nav id="menubar" role="navigation" aria-label="メインメニュー">
      <ul>
        <li><a href="#">時間割 <span>time table</span></a>
          <ul>
            <li><a href="#timetable" data-nav="timetable">一年</a></li>
            <li><a href="#timetable" data-nav="timetable">二年</a></li>
            <li><a href="#timetable" data-nav="timetable">三年</a></li>
          </ul>
        </li>
        <li><a href="#">課題 <span>Homework</span></a>
          <ul>
            <li><a href="#tasks" data-nav="tasks">一年</a></li>
            <li><a href="#tasks" data-nav="tasks">二年</a></li>
            <li><a href="#tasks" data-nav="tasks">三年</a></li>
          </ul>
        </li>
        <li><a href="#">行事 <span>event</span></a>
          <ul>
            <li><a href="#events" data-nav="events">体育祭</a></li>
            <li><a href="#events" data-nav="events">四葉祭</a></li>
            <li><a href="#events" data-nav="events">修学旅行</a></li>
          </ul>
        </li>
        <li><a href="#">テスト <span>tests</span></a>
          <ul>
            <li><a href="#tests" data-nav="timetable">一年</a></li>
            <li><a href="#tests" data-nav="timetable">二年</a></li>
            <li><a href="#tests" data-nav="timetable">三年</a></li>
          </ul>
        </li>
      </ul>
      <div id="menubar_hdr">メニュー</div>
    </nav>

    <!-- main content -->
    <main style="padding:18px">
      <div style="margin-bottom:10px;color:var(--muted);font-size:0.9rem">最終更新: <span id="lastUpdated">--</span></div>
      <div class="wrap-grid">
        <section>
          <!-- HOME -->
          <div class="panel" id="page-home" data-page="home">
            <div class="spaced"><h2>お知らせ</h2><span class="small">注目の更新</span></div>
            <div id="newsList" style="margin-top:12px"></div>
          </div>

          <!-- TIMETABLE -->
          <div class="panel" id="page-timetable" data-page="timetable" style="display:none;margin-top:16px">
            <div class="spaced"><h2>時間割</h2><span class="small">学年／組ごとに表示</span></div>
            <div style="margin-top:12px">
              <!-- ここに元サイトの時間割テーブルをそのまま配置 -->
              <h3>1組</h3>
              <div class="tablewrap">
                <table class="Table">
                  <thead class="Table-Head"><tr class="Table-Head-Row"><th class="Table-Head-Row-Cell">月曜日</th><th>火曜日</th><th>水曜日</th><th>木曜日</th><th>金曜日</th></tr></thead>
                  <tbody class="Table-Body">
                    <tr><td>美術・音楽</td><td>言語文化</td><td>体育</td><td>理数数学1+A</td><td>理数化学</td></tr>
                    <tr><td>美術・音楽</td><td>現代の国語</td><td>保健</td><td>現代の国語</td><td>理数化学</td></tr>
                    <tr><td>理数生物</td><td>論理表現１</td><td>理数数学1+A</td><td>EC1</td><td>論理表現１</td></tr>
                    <tr><td>理数生物</td><td>理数数学1+B</td><td>公共</td><td>EC1</td><td>歴史総合</td></tr>
                    <tr><td>EC1</td><td>理数化学</td><td>理数数学1+B</td><td>体育</td><td>理数数学1+A</td></tr>
                    <tr><td>公共</td><td>理数物理</td><td>情報１</td><td>言語文化</td><td>創造理数探求基礎</td></tr>
                    <tr><td>歴史総合</td><td>理数物理</td><td>情報1</td><td>LHR</td><td>創造理数探求基礎</td></tr>
                  </tbody>
                </table>
              </div>

              <!-- 他の組も同様に（省略せず全て入れてあります） -->
              <h3 style="margin-top:12px">2組</h3>
              <div class="tablewrap">
                <table class="Table">
                  <thead><tr><th>月曜日</th><th>火曜日</th><th>水曜日</th><th>木曜日</th><th>金曜日</th></tr></thead>
                  <tbody>
                    <tr><td>美術・音楽</td><td>論理表現１</td><td>体育</td><td>公共</td><td>現代の国語</td></tr>
                    <tr><td>美術・音楽</td><td>数学１</td><td>生物基礎</td><td>化学基礎</td><td>数学A</td></tr>
                    <tr><td>数学１</td><td>生物基礎</td><td>EC1</td><td>数学１</td><td>言語文化</td></tr>
                    <tr><td>現代の国語</td><td>化学基礎</td><td>EC1</td><td>保健</td><td>工業情報数理</td></tr>
                    <tr><td>数学A</td><td>言語文化</td><td>SS工学技術基礎</td><td>体育</td><td>EC1</td></tr>
                    <tr><td>物理基礎</td><td>SS科学技術探究</td><td>工学技術基礎</td><td>工業情報数理</td><td>論理表現１</td></tr>
                    <tr><td>物理基礎</td><td>SS科学技術探究</td><td>SS工学技術基礎</td><td>LHR</td><td>公共</td></tr>
                  </tbody>
                </table>
              </div>

              <!-- 3〜6組も同様に続きます（長いため省略しません） -->
              <h3 style="margin-top:12px">3組</h3>
              <div class="tablewrap">
                <table class="Table">
                  <thead><tr><th>月</th><th>火</th><th>水</th><th>木</th><th>金</th></tr></thead>
                  <tbody>
                    <tr><td>化学基礎</td><td>数学1</td><td>EC1</td><td>現代の国語</td><td>言語文化</td></tr>
                    <tr><td>数学1</td><td>数学A</td><td>EC1</td><td>論理表現１</td><td>生物基礎</td></tr>
                    <tr><td>美術・音楽</td><td>化学基礎</td><td>体育</td><td>体育</td><td>数学1</td></tr>
                    <tr><td>美術・音楽</td><td>工業情報数理</td><td>保健</td><td>工業情報数理</td><td>公共</td></tr>
                    <tr><td>数学A</td><td>公共</td><td>生物基礎</td><td>物理基礎</td><td>工業技術基礎</td></tr>
                    <tr><td>論理表現１</td><td>現代の国語</td><td>科学技術探究</td><td>物理基礎</td><td>工業技術基礎</td></tr>
                    <tr><td>EC1</td><td>言語文化</td><td>科学技術探究</td><td>LHR</td><td>工業技術基礎</td></tr>
                  </tbody>
                </table>
              </div>

              <h3 style="margin-top:12px">4組</h3>
              <div class="tablewrap">
                <table class="Table">
                  <thead><tr><th>月</th><th>火</th><th>水</th><th>木</th><th>金</th></tr></thead>
                  <tbody>
                    <tr><td>公共</td><td>数学1</td><td>EC1</td><td>論理表現１</td><td>生物基礎</td></tr>
                    <tr><td>数学1</td><td>言語文化</td><td>EC1</td><td>保健</td><td>現代の国語</td></tr>
                    <tr><td>美術・音楽</td><td>生物基礎</td><td>体育</td><td>体育</td><td>数学1</td></tr>
                    <tr><td>美術・音楽</td><td>工業情報数理</td><td>化学基礎</td><td>工業情報数理</td><td>論理表現１</td></tr>
                    <tr><td>言語文化</td><td>現代の国語</td><td>数学A</td><td>物理基礎</td><td>工業技術基礎</td></tr>
                    <tr><td>化学基礎</td><td>数学A</td><td>科学技術探究</td><td>物理基礎</td><td>工業技術基礎</td></tr>
                    <tr><td>EC1</td><td>公共</td><td>科学技術探究</td><td>LHR</td><td>工業技術基礎</td></tr>
                  </tbody>
                </table>
              </div>

              <h3 style="margin-top:12px">5組</h3>
              <div class="tablewrap">
                <table class="Table">
                  <thead><tr><th>月</th><th>火</th><th>水</th><th>木</th><th>金</th></tr></thead>
                  <tbody>
                    <tr><td>数学1</td><td>生物基礎</td><td>数学A</td><td>EC1</td><td>数学1</td></tr>
                    <tr><td>論理表現１</td><td>論理表現１</td><td>体育</td><td>EC1</td><td>数学A</td></tr>
                    <tr><td>化学基礎</td><td>数学1</td><td>公共</td><td>保健</td><td>生物基礎</td></tr>
                    <tr><td>工業情報数理</td><td>現代の国語</td><td>工業情報数理</td><td>体育</td><td>言語文化</td></tr>
                    <tr><td>美術・音楽</td><td>工業技術基礎</td><td>言語文化</td><td>科学技術探究</td><td>化学基礎</td></tr>
                    <tr><td>美術・音楽</td><td>工業技術基礎</td><td>物理基礎</td><td>科学技術探究</td><td>EC1</td></tr>
                    <tr><td>公共</td><td>工業技術基礎</td><td>物理基礎</td><td>LHR</td><td>現代の国語</td></tr>
                  </tbody>
                </table>
              </div>

              <h3 style="margin-top:12px">6組</h3>
              <div class="tablewrap">
                <table class="Table">
                  <thead><tr><th>月</th><th>火</th><th>水</th><th>木</th><th>金</th></tr></thead>
                  <tbody>
                    <tr><td>数学1</td><td>公共</td><td>言語文化</td><td>EC1</td><td>数学1</td></tr>
                    <tr><td>化学基礎</td><td>生物基礎</td><td>体育</td><td>EC1</td><td>生物基礎</td></tr>
                    <tr><td>現代の国語</td><td>数学1</td><td>保健</td><td>公共</td><td>現代の国語</td></tr>
                    <tr><td>工業情報数理</td><td>論理表現１</td><td>工業情報数理</td><td>体育</td><td>数学A</td></tr>
                    <tr><td>美術・音楽</td><td>工業技術基礎</td><td>化学基礎</td><td>科学技術探究</td><td>言語文化</td></tr>
                    <tr><td>美術・音楽</td><td>工業技術基礎</td><td>物理基礎</td><td>科学技術探究</td><td>EC1</td></tr>
                    <tr><td>数学A</td><td>工業技術基礎</td><td>物理基礎</td><td>LHR</td><td>論理表現１</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- TASKS -->
          <div class="panel" id="page-tasks" data-page="tasks" style="display:none;margin-top:16px">
            <div class="spaced"><h2>課題一覧</h2><span class="small">先生のスプレッドシート＋冬休み課題＋個人メモ</span></div>

            <!-- 検索 / 追加 -->
            <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
              <input id="taskSearch" class="searchin" placeholder="科目・キーワードで検索（埋め込みiframe内は検索不可）">
              <button id="newTaskBtn" class="btn primary">課題を追加</button>
            </div>

            <!-- 先生用スプレッドシート -->
            <div style="margin-top:12px">
              <div class="small meta">先生用スプレッドシート（この埋め込み内はブラウザの制約で検索対象外です）</div>
              <div class="iframewrap" style="margin-top:8px">
                <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRzoh-UAIM-g77R8Ss64lDUT_juqWh-TSMLecY3ic5-9ortA8vCNxQTNZm3DTBsEFlw4lZL7VLZ-1sa/pubhtml?widget=true&amp;headers=false" loading="lazy"></iframe>
              </div>
            </div>

            <!-- 冬休みの課題カード -->
            <div style="margin-top:16px">
              <h3>冬休みの課題</h3>
              <div id="winterTasks" class="list-container">
                <!-- 各カード（データ属性で検索対象） -->
                <div class="task-card" data-subject="EC" data-content="スタディサプリ 28本の動画を視聴後、確認テスト全問回答" data-due="1月8日">
                  <h4>EC</h4>
                  <dl>
                    <dt>課題</dt><dd>スタディサプリ</dd>
                    <dt>課題内容</dt><dd>28本の動画を視聴後、確認テスト全問回答</dd>
                    <dt>提出期限</dt><dd>1月8日</dd>
                  </dl>
                  <p style="margin-top:8px"><a class="btn" href="#">詳細</a></p>
                </div>

                <div class="task-card" data-subject="言語文化" data-content="古文単語 p211～230までを確認" data-due="提出なし">
                  <h4>言語文化</h4>
                  <dl>
                    <dt>課題</dt><dd>古文単語</dd>
                    <dt>課題内容</dt><dd>p211～230までを確認</dd>
                    <dt>提出期限</dt><dd>提出なし</dd>
                  </dl>
                  <p style="margin-top:8px"><a class="btn" href="#">詳細</a></p>
                </div>

                <div class="task-card" data-subject="論理表現" data-content="英単語 p10～329までを確認" data-due="提出なし">
                  <h4>論理表現</h4>
                  <dl>
                    <dt>課題</dt><dd>英単語</dd>
                    <dt>課題内容</dt><dd>p10～329までを確認</dd>
                    <dt>提出期限</dt><dd>提出なし</dd>
                  </dl>
                  <p style="margin-top:8px"><a class="btn" href="#">詳細</a></p>
                </div>

                <div class="task-card" data-subject="数学" data-content="青チャート 数1A:数Ⅱ指数関数 / 数1B:数Ⅰ三角比" data-due="数学初回授業にて提出">
                  <h4>数学</h4>
                  <dl>
                    <dt>課題</dt><dd>青チャート</dd>
                    <dt>課題内容</dt><dd>数1A:数Ⅱ指数関数 / 数1B:数Ⅰ三角比</dd>
                    <dt>提出期限</dt><dd>数学初回授業にて提出</dd>
                  </dl>
                  <p style="margin-top:8px"><a class="btn" href="#">詳細</a></p>
                </div>
              </div>
            </div>

            <!-- ローカル課題テーブル -->
            <div style="margin-top:16px" class="panel">
              <div class="spaced"><strong>ローカル課題（個人メモ）</strong><span class="small">ブラウザのローカルストレージに保存されます</span></div>
              <div class="tablewrap" style="margin-top:8px">
                <table id="tasksTable">
                  <thead><tr><th>科目</th><th>内容</th><th>提出期限</th><th>状態</th></tr></thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- EVENTS -->
          <div class="panel" id="page-events" data-page="events" style="display:none;margin-top:16px">
            <div class="spaced"><h2>行事カレンダー</h2><span class="small">主要行事を掲載</span></div>
            <div id="eventsList" style="margin-top:12px"></div>
          </div>

          <!-- ABOUT -->
          <div class="panel" id="page-about" data-page="about" style="display:none;margin-top:16px">
            <h2>このサイトについて</h2>
            <p class="small">このページは既存サイト（Template-Party 風）と改良デモを統合したサンプルです。公開運用ではサーバー側の認証・DBを使うことを推奨します。</p>
          </div>
        </section>

        <!-- ASIDE -->
        <aside>
          <div class="panel">
            <h3>クイック操作</h3>
            <div style="margin-top:10px;display:flex;gap:8px">
              <button class="btn" id="btnLogin">ログイン</button>
              <button class="btn" id="btnRefresh">更新</button>
            </div>
            <p class="small" style="margin-top:8px">検索や追加はログイン後にできます（デモ）。</p>
          </div>

          <div class="panel">
            <h3>使い方メモ</h3>
            <ol class="small" style="padding-left:18px;margin:8px 0 0">
              <li>ログインして内容を追加（デモはクライアント保存）</li>
              <li>課題スプレッドシートは先生が管理</li>
              <li>公開時は外部DBやAPI連携を検討</li>
            </ol>
          </div>

          <div class="panel">
            <h3>フッターメニュー</h3>
            <div id="footermenu" style="display:flex;gap:12px;flex-wrap:wrap">
              <ul><li class="title">メニュー</li><li><a href="#">ホーム</a></li><li><a href="#">学年行事</a></li><li><a href="#">お問い合わせ</a></li></ul>
              <ul><li class="title">時間割</li><li><a href="#">1年</a></li><li><a href="#">2年</a></li><li><a href="#">3年</a></li></ul>
            </div>
          </div>
        </aside>
      </div>
    </main>

    <footer>
      <small>Copyright &copy; JOB INFO — 統合デモ</small>
      <div class="small">Template: Template-Party 風デザイン（デモ）</div>
    </footer>
  </div>

  <!-- ログインオーバーレイ（デモ） -->
  <div id="overlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.45);align-items:center;justify-content:center;z-index:60">
    <div style="background:#fff;padding:18px;border-radius:8px;width:92%;max-width:460px;margin:auto">
      <h3 style="margin:0 0 8px">ログイン</h3>
      <p class="small">管理者はログイン後にローカル課題を追加できます（デモ）。</p>
      <div style="margin-top:8px"><input id="pw" type="password" placeholder="パスワード" style="width:100%;padding:10px;border:1px solid #eef4f8;border-radius:6px"></div>
      <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
        <button id="ok" class="btn primary">ログイン</button>
        <button id="browse" class="btn">閲覧する</button>
      </div>
      <div id="err" style="color:#b91c1c;margin-top:8px;display:none"></div>
      <p class="small" style="margin-top:8px">※デモ用パスワード: <strong>1234</strong>（本番ではサーバー認証を導入してください）</p>
    </div>
  </div>

  <script>
    /* === データ（デモ） === */
    const state = {
      password:'1234',
      lastUpdated:null,
      news:[{title:'サイトを統合しました', date:'2025-09-29', body:'既存サイトの課題・時間割を統合しました。'}],
      tasks:[
        {subject:'数学', content:'宿題：問題集P24〜26', due:'2025-10-10', status:'未提出'},
        {subject:'英語', content:'英単語テスト範囲：Unit3', due:'2025-10-05', status:'未提出'}
      ],
      events:[{date:'2025-10-15', title:'文化祭', desc:'地域公開。集合：8:30'}]
    };

    function todayISO(){ return new Date().toISOString().slice(0,10); }

    function escapeHtml(str){
      if(!str && str !== 0) return '';
      return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
    }

    function renderAll(){
      document.getElementById('lastUpdated').textContent = state.lastUpdated || '未更新';
      renderNews(); renderTasks(); renderEvents();
    }

    function renderNews(){
      const el = document.getElementById('newsList'); el.innerHTML='';
      state.news.forEach(n=>{
        const d = document.createElement('div');
        d.innerHTML = `<strong>${escapeHtml(n.title)}</strong> <div class="meta">${escapeHtml(n.date)}</div><div style="margin-top:6px">${escapeHtml(n.body)}</div>`;
        d.style.marginBottom='10px';
        el.appendChild(d);
      });
    }

    function renderTasks(filter=''){
      const tbody = document.querySelector('#tasksTable tbody'); tbody.innerHTML='';
      const q=(filter||'').toLowerCase();
      state.tasks.filter(t => (t.subject + ' ' + t.content + ' ' + t.due + ' ' + t.status).toLowerCase().includes(q))
        .forEach(t=>{
          const tr=document.createElement('tr');
          tr.innerHTML = `<td>${escapeHtml(t.subject)}</td><td>${escapeHtml(t.content)}</td><td>${escapeHtml(t.due)}</td><td>${escapeHtml(t.status)}</td>`;
          tbody.appendChild(tr);
        });
      filterWinterCards(q);
    }

    function renderEvents(){
      const el=document.getElementById('eventsList'); el.innerHTML='';
      state.events.forEach(e=>{
        const d = document.createElement('div');
        d.innerHTML = `<strong>${escapeHtml(e.date)} — ${escapeHtml(e.title)}</strong><div class="meta">${escapeHtml(e.desc)}</div>`;
        d.style.marginBottom='10px';
        el.appendChild(d);
      });
    }

    /* ナビ */
    document.querySelectorAll('a[data-nav]').forEach(a=>{
      a.addEventListener('click', (ev)=>{
        ev.preventDefault();
        const page = a.getAttribute('data-nav');
        document.querySelectorAll('[data-page]').forEach(p=>p.style.display='none');
        const show = document.getElementById('page-'+page);
        if(show) show.style.display='block';
        window.scrollTo({top:0,behavior:'smooth'});
      });
    });

    /* レスポンシブメニュー開閉（簡易） */
    document.getElementById('menubar_hdr').addEventListener('click', ()=>{
      document.querySelectorAll('#menubar > ul > li').forEach(li => li.classList.toggle('open'));
    });

    /* ログイン（デモ） */
    const overlay = document.getElementById('overlay');
    const pw = document.getElementById('pw');
    const err = document.getElementById('err');
    document.getElementById('ok').addEventListener('click', ()=>{
      if(pw.value === state.password){
        overlay.style.display='none';
        state.lastUpdated = todayISO();
        saveState();
        renderAll();
      } else {
        err.style.display='block'; err.textContent='パスワードが違います。';
      }
    });
    document.getElementById('browse').addEventListener('click', ()=>{
      overlay.style.display='none';
      renderAll();
    });
    document.getElementById('btnLogin').addEventListener('click', ()=> overlay.style.display='flex');
    pw && pw.addEventListener('keyup', e=> { if(e.key==='Enter') document.getElementById('ok').click(); });

    /* タスク追加 */
    document.getElementById('newTaskBtn').addEventListener('click', ()=>{
      const subject = prompt('科目名を入力'); if(!subject) return;
      const content = prompt('課題内容を入力'); if(!content) return;
      const due = prompt('提出期限を YYYY-MM-DD 形式で入力（例:2025-10-10）', todayISO()); if(!due) return;
      state.tasks.push({subject, content, due, status:'未提出'});
      state.lastUpdated = todayISO();
      saveState();
      renderTasks(document.getElementById('taskSearch').value);
    });

    /* 検索（ローカル課題 + 冬休みカード） */
    document.getElementById('taskSearch').addEventListener('input', (e)=>{
      renderTasks(e.target.value);
    });
    function filterWinterCards(q){
      const cards = document.querySelectorAll('#winterTasks .task-card');
      cards.forEach(card=>{
        const subj = (card.dataset.subject||'').toLowerCase();
        const cont = (card.dataset.content||'').toLowerCase();
        const due = (card.dataset.due||'').toLowerCase();
        const show = (!q) || subj.includes(q) || cont.includes(q) || due.includes(q);
        card.style.display = show ? 'block' : 'none';
      });
    }

    /* ローカル保存 */
    function saveState(){ localStorage.setItem('ot_demo_state', JSON.stringify(state)); }
    function loadState(){
      try{
        const d = JSON.parse(localStorage.getItem('ot_demo_state'));
        if(d){
          if(Array.isArray(d.tasks)) state.tasks = d.tasks;
          if(Array.isArray(d.news)) state.news = d.news;
          if(Array.isArray(d.events)) state.events = d.events;
          if(d.lastUpdated) state.lastUpdated = d.lastUpdated;
        }
      }catch(e){ console.warn('load fail', e); }
    }
    document.getElementById('btnRefresh').addEventListener('click', ()=>{ loadState(); renderAll(); alert('ローカルストレージから読み込みました（デモ）。'); });

    /* 初期化 */
    (function init(){
      loadState();
      renderAll();
      // 初回はHOME表示
      document.querySelectorAll('[data-page]').forEach(p=>p.style.display='none');
      document.getElementById('page-home').style.display='block';
    })();
  </script>
</body>
</html>
